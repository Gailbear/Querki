@(rc:PlayRequestContext)

@import play.api.Logger

@import models.system.IsModelProp

@space = @{ rc.state.get }
@thing = @{
  rc.thing match {
    case Some(t) => t
    case None => space
  }
}
@title = @{ thing.displayName }
@user = @{ rc.requester }
@rawThingId = @{ thing.id.toThingId.toString }

@canEdit = @{
  user.isDefined && space.canEdit(user.get, thing)
}

@modelOpt = @{ thing.getModelOpt(space) }

@linkTo(t:Thing) = {
  <a href="@routes.Application.thing(rc.ownerId.toThingId, space.toThingId, t.toThingId)">@t.displayNameText.html</a>
}

@nameAsWell = @{
  val linkNameOpt = thing.linkName
  linkNameOpt match {
    case Some(linkName) => Html(s""", Link Name: <a href="${routes.Application.thing(rc.ownerId.toThingId, space.toThingId, thing.toThingId)}">${linkName}</a>""")
    case None => Html("")
  }
}

@main(QuerkiTemplate.Thing, title, rc, true) {

    <script>
      $(function() {
        $(".clickToEdit").on("dblclick", function() {
        // TODO (justin 5/22/13): personally, I like this, but I suspect it is begging for disaster to have it
        // be universal. Later, we should add it back in as an optional user preference.
        //  window.location = "@routes.Application.editThing(rc.ownerHandle, space.toThingId, thing.toThingId)";
        });
      });
    </script>
    
    @if(rc.hasProp) {
    
      @Html(thing.render(rc, rc.prop).display)

    } else {
	  <div class="clickToEdit">

        @if(!rc.chromeless) {
	    <div class="page-header">
	      <h1 class="_defaultTitle">@Html(title) 
	        @if(canEdit) { <a class="btn btn-mini btn-primary" title="Edit @Html(title)" href="@routes.Application.editThing(rc.ownerHandle, space.toThingId, thing.toThingId)"><i class="icon-edit icon-white"></i></a> }
	        @if(thing.ifSet(IsModelProp)(space)) { <a class="btn btn-mini btn-primary" title="Create a @Html(title)" href="@routes.Application.createThing(rc.ownerHandle, space.toThingId, Some(thing.toThingId))"><i class="icon-plus-sign icon-white"></i></a> }
	      </h1>
	      @modelOpt match { 
	        case Some(model) => {
	          <p class="_smallSubtitle">(OID: <a href="@routes.Application.thing(rc.ownerId.toThingId, space.toThingId, rawThingId)">@rawThingId</a>@nameAsWell, 
	            Model: @linkTo(model))
	          </p>
	        }
	        case _ => {}
	      }
	    </div>
	    }
	
        @Html(thing.render(rc).display)
	  
	  </div>
	}
}
