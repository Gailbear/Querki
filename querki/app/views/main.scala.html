@(template:QuerkiTemplate.QuerkiTemplate, title: String, rc:RequestContext, addStyles:Boolean = false)(content: Html)

@import models.system._
@import play.api.Logger

@space = @{ rc.state }
@thing = @{ rc.thing }
@nav = @{
  rc.state match {
    case Some(space) => NavSection.spaceNav(rc)
    case None => NavSection.homeNav
  }
}
@errors = @{
  val flash = rc.request.flash
  flash.get("error") orElse rc.error
}
@requester = @{ rc.requester }

<!DOCTYPE html>

@*********************
 * This is the main system template. We'll get fancier as things go,
 * but by and large, all universal template shell should go here.
 *
 * Most of this is adapted from Bootstrap's "fluid" example:
 *   http://twitter.github.com/bootstrap/examples/fluid.html
 ********************@

<html>
    <head>
        <title>@title</title>
        <!-- TODO: we need to make this CSS responsive! But that may require jQuery Mobile... -->
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/jquery-ui-1.10.0.custom.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/jquery.ui.menubar.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/bootstrap.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/bootstrap-responsive.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/main.css")">
        
        <!-- TODO: these should come from a jQuery CDN, instead of locally -->
        <script src="@routes.Assets.at("javascripts/jquery-1.9.0.js")"></script>
        <script src="@routes.Assets.at("javascripts/jquery-ui-1.10.0.custom.js")"></script>
        <script src="@routes.Assets.at("javascripts/jquery.ui.menubar.js")"></script>        
        <script src="@routes.Assets.at("javascripts/bootstrap.js")"></script>        

        @PageEventManager.addHeaders(rc, template)

        <link rel="shortcut icon" type="image/png" href="@routes.Assets.at("images/favicon.png")">
        
		<script>
		$(function() {
			$("#querkiBar").menubar({
				autoExpand: true,
				menuIcon: true,
				buttons: false
			});
			
			$("#identityMenu").position({
				my: "right",
				at: "right"
			});
		});
		</script>
		
	<style>
		#querkiBar { margin: 0 0 0 0; }
		
		body {
		  margin: 0;
		}
		
		.guts {
		  margin: 8px;
		}
		
 	</style>
    </head>
    <body>
	    @if(!rc.chromeless) {
		    <ul id="querkiBar" class="menubar">
				<li><a href="/">Querki</a></li>
				<li><a href="#Space">Space</a>
					<ul>
						<li><a href="#AllThings">All Things</a></li>
						<li class="ui-state-disabled"><a href="#">Open recent...</a></li>
						<li><a href="#CreateThing">Create Thing</a></li>
						<li><a href="#AddProperty">Add Property</a></li>
						<li><a href="#Upload">Upload</a></li>
					</ul>
				</li>
				<li><a href="#Thing">Thing</a>
					<ul>
						<li><a href="#Edit">Edit</a></li>
					</ul>
				</li>
				<!-- TODO: this should be top right -->
				<!-- TODO: this should show differently if not logged in -->
				@requester match {
					case None => { 
						<li id="identityMenu"><a href="#NoLogin">Not logged in</a>
							<ul>
								<li><a href="#Login">Log in</a></li>
								<li><a href="#Signup">Sign up</a></li>
							</ul>
						</li>
					}
					case Some(u) => {
						<li id="identityMenu"><a href="#MyProfile">Logged in as @u.name</a>
							<ul>
								<li><a href="#Spaces">Your Spaces</a></li>
								<li><a href="#Logout">Logout</a></li>
							</ul>
						</li>			
					}
				}		
		
              @for(section <- nav.sections) {
                <li><a href="#@section.title">@section.title</a>
                  <ul>
                  @for(link <- section.links) {
                    <li><a href="@link.url">@link.display</a></li>
                  }
                  </ul>
                </li>
              }
			</ul>
	    }
		
	<!-- This container stuff is likely to go into a lower-level, Space-rendering template -->
	<div class="guts container-fluid">
      <div class="row-fluid">
        <div class="querki-content span12">

		  @errors match {
			case None => {}
			case Some(msg) => { 
		      <div class="alert">
		        <button type="button" class="close" data-dismiss="alert">x</button>
		        <strong>Error:</strong> @msg
		      </div>
			}
	      }

          @content
	
		</div><!--/span12-->
      </div><!--/row-->

      @if(!rc.chromeless) {
      <hr>

      <footer>
        <p>&copy; Querki 2012</p>
      </footer>
      }

    </div><!--/.fluid-container-->
    </body>
</html>
