@(title: String, rc:RequestContext, addStyles:Boolean = false)(content: Html)

@import models.system._

@space = @{ rc.state }
@thing = @{ rc.thing }
@nav = @{
  rc.state match {
    case Some(space) => NavSection.spaceNav(rc)
    case None => NavSection.homeNav
  }
}
@errors = @{
  val flash = rc.request.flash
  flash.get("error") orElse rc.error
}

<!DOCTYPE html>

@*********************
 * This is the main system template. We'll get fancier as things go,
 * but by and large, all universal template shell should go here.
 *
 * Most of this is adapted from Bootstrap's "fluid" example:
 *   http://twitter.github.com/bootstrap/examples/fluid.html
 *
 * TODO: by now, this is taking OMG a lot of params. Time to lift out a
 * DisplayContext structure.
 ********************@

<html>
    <head>
        <title>@title</title>
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/main.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/bootstrap.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/bootstrap-responsive.css")">
		
		<style type="text/css">
          body {
            padding-top: 60px;
            padding-bottom: 40px;
          }
          .sidebar-nav {
            padding: 9px 0;
          }
        </style>

        @if(addStyles) {        
        @if(space.isDefined && thing.isDefined && thing.get.hasProp(OIDs.StylesheetOID)(space.get)) {
          @defining(thing.get.first(StylesheetProp)(space.get)) { stylesheetOID =>
          @defining(space.get.thing(stylesheetOID)) { stylesheetThing =>
            @if(stylesheetThing.kind == Kind.Attachment) {
              <link rel="stylesheet" media="screen" href="@routes.Application.attachment(rc.ownerName, space.get.toThingId, stylesheetThing.toThingId)">
            } else {
              @if(stylesheetThing.hasProp(OIDs.GoogleFontOID)(space.get)) {
                <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=@stylesheetThing.first(GoogleFontProp)(space.get).raw.toString">
              }
              <style type="text/css">
              @stylesheetThing.first(CSSProp)(space.get)
              </style>
            }
          }
          }
        }
        }
        <link rel="shortcut icon" type="image/png" href="@routes.Assets.at("images/favicon.png")">

    </head>
    <body>
    @if(!rc.chromeless) {
    <div class="querki-topbar navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Querki</a>
          <div class="nav-collapse collapse">
            <p class="navbar-text pull-right">
              @defining(rc.requester) { requester =>
			  @requester match {
			    case None => { <span>Not logged in</span> }
				case Some(u) => { <span>Logged in as <a href="#" class="navbar-link">@u.name</a></span>	}
			  }
			  }
            </p>
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <li><a href="#about">About</a></li>
              <li><a href="#contact">Contact</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--container-fluid-->
      </div><!--navbar-inner-->
    </div><!--querki-topbar-->
    }
	
	<!-- This container stuff is likely to go into a lower-level, Space-rendering template -->
	<div class="container-fluid">
      <div class="row-fluid">
        @if(!rc.chromeless) {
        <div class="span2 querki-sidebar">
          <div class="well sidebar-nav">
            <p style="text-align:center"><b>@title</b></p>
            <ul class="nav nav-list">
              @for(section <- nav.sections) {
                <li class="nav-header">@section.title</li>
                @for(link <- section.links) {
                  <li><a href="@link.url">@link.display</a></li>
                }
              }
            </ul>
          </div><!--/.well -->
        </div><!--/span2-->
        }
        
        @if(rc.chromeless) {
        <div class="querki-content span12">
        } else {
        <div class="querki-content span10">
		}
		  @errors match {
			case None => {}
			case Some(msg) => { 
		      <div class="alert">
		        <button type="button" class="close" data-dismiss="alert">x</button>
		        <strong>Error:</strong> @msg
		      </div>
			}
	      }
	
          @content
		</div><!--/span10-->
      </div><!--/row-->

      @if(!rc.chromeless) {
      <hr>

      <footer>
        <p>&copy; Querki 2012</p>
      </footer>
      }

    </div><!--/.fluid-container-->
	
    </body>
	<!-- At the bottom, to speed page load -->
    <script src="@routes.Assets.at("javascripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/bootstrap.js")" type="text/javascript"></script>
</html>
